<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>常见问题 - Untitled</title>
    
    
</head>
<body>
<div id="root"></div>
<script type="application/payload+json">
{"id":"Jrymro","sha":"164504e743217af9f2c75534a7496bb2b403bd27","summary":[{"title":"","articles":[{"title":"安装说明","ref":"installation.md","path":"installation.html","metadata":{"mtime":"2021-08-26T04:02:01+00:00"},"children":[{"title":"tracker服务端","ref":"installation\/server.md","path":"installation\/server.html","metadata":{"mtime":"2020-10-01T02:43:42+00:00"},"children":[{"title":"数据存储","ref":"installation\/server\/data-storage.md","path":"installation\/server\/data-storage.html","metadata":{"mtime":"2020-03-05T02:13:12+00:00"}},{"title":"更换数据存储配置","ref":"change-db.md","path":"change-db.html","metadata":{"mtime":"2020-09-23T06:27:02+00:00"}},{"title":"Server管理","ref":"installation\/server\/manage.md","path":"installation\/server\/manage.html","metadata":{"mtime":"2020-02-28T03:05:17+00:00"}},{"title":"数据清理","ref":"installation\/clean-log.md","path":"installation\/clean-log.html","metadata":{"mtime":"2021-08-25T06:03:28+00:00"}}]},{"title":"tracker客户端","ref":"installation\/client.md","path":"installation\/client.html","metadata":{"mtime":"2021-08-26T04:02:01+00:00"},"children":[{"title":"系统配置","ref":"installation\/client\/agent-config.md","path":"installation\/client\/agent-config.html","metadata":{"mtime":"2020-09-17T11:29:08+00:00"}},{"title":"自定义配置","ref":"installation\/client\/user-config.md","path":"installation\/client\/user-config.html","metadata":{"mtime":"2021-09-06T02:37:48+00:00"}},{"title":"链路追踪扩展","ref":"installation\/client\/trace_tlist.md","path":"installation\/client\/trace_tlist.html","metadata":{"mtime":"2021-09-06T02:37:48+00:00"}}]},{"title":"上报监控数据","ref":"installation\/reprot.md","path":"installation\/reprot.html","metadata":{"mtime":"2021-09-08T09:58:59+00:00"}}]},{"title":"名词解释","ref":"noun-interpretation.md","path":"noun-interpretation.html","metadata":{"mtime":"2019-09-27T03:11:51+00:00"}},{"title":"常见问题","ref":"qa.md","path":"qa.html","metadata":{"mtime":"2021-01-02T10:50:19+00:00"}},{"title":"首页","ref":"application-list.md","path":"application-list.html"},{"title":"调用统计","ref":"application-monitoring.md","path":"application-monitoring.html"},{"title":"链路追踪","ref":"application-tracking.md","path":"application-tracking.html"},{"title":"调试器适用场景","ref":"debug-explain.md","path":"debug-explain.html"},{"title":"调试器","ref":"debuger.md","path":"debuger.html"},{"title":"免费内存检测工具","ref":"leak.md","path":"leak.html"},{"title":"Agent列表","ref":"agent-list.md","path":"agent-list.html"},{"title":"机器信息","ref":"sysinfo.md","path":"sysinfo.html"},{"title":"报警管理","ref":"alert.md","path":"alert.html"},{"title":"项目管理","ref":"project.md","path":"project.html"},{"title":"应用管理","ref":"module.md","path":"module.html"},{"title":"接口管理","ref":"interface.md","path":"interface.html"},{"title":"用户管理","ref":"user.md","path":"user.html","children":[{"title":"第三方登录","ref":"user\/oauth-login.md","path":"user\/oauth-login.html"}]},{"title":"对外开放API","ref":"api.md","path":"api.html"},{"title":"联系我们","ref":"contact-us.md","path":"contact-us.html"}]}],"config":{"plugins":["highlight","image-zoom"],"pluginsConfig":{"highlight":{"defaultLanguage":"markup"},"theme-default":{"show_nav":true,"logo":{"image":"https:\/\/img.kancloud.cn\/4e\/45\/4e45172f86ac746e40eb69c2827ae271_157x77.png","url":"https:\/\/business.swoole.com\/"}}},"themeConfig":{"expandLevel":1,"navs":[{"title":"Swoole Tracker 详细手册","url":"http:\/\/wiki.tracker.swoole-cloud.com"},{"title":"基础手册","url":"http:\/\/base-wiki.tracker.swoole-cloud.com"}]}},"file":{"path":"qa.html","content":"**1. 一切问题先检查客户端、`swoole_tracker`扩展、服务端版本是否一致，是否为最新发布版本；\n2. 客户端Agent服务是否启动；\n3. 安装扩展完成以后是否重启客户端 Server 服务或 php-fpm 服务；**\n\n>[success] swoole_tracker扩展的发布版本可能会出现比客户端、服务端高，这个不影响。\n\n* 查看客户端版本 `ps -ef | grep agent`\n\n![](images\/screenshot_1575600651609.png)\n\n* 查看 `swoole_tracker` 扩展版本\n\n```ini\n;php.ini不要忘了添加\nextension=swoole_tracker.so\napm.enable=1\napm.sampling_rate=100\n```\n\n>[info] cli模式 php --ri swoole_tracker\n![](images\/screenshot_1566982363491.png)\n\n>[success] fpm模式 phpinfo()\n![](images\/screenshot_1566982305216.png)\n\n* 查看服务端版本\n\n![](images\/screenshot_1565061881319.png)\n\n[TOC]\n\n## 1. 找不到对应应用\n\n* 查看项目是否正确，自动创建的应用会放到默认项目中\n* 检查该应用是否存在合并应用或应用黑名单中\n* 检查客户端`swoole_tracker` 配置是否正确，参考安装说明->客户端\n* 检查客户端是否给该服务端上报\n\n## 2. 调用统计\/链路追踪无信息\n\n* 检查对应后台地址(IP或域名)是否正确，防火墙、安全组中端口是否开放\n>[danger] 请开放出入端口：**9903,9904,9907,9981,9990,8995,9666**\n* 检查客户端进程是否存在\n* 检查客户端`swoole_tracker`配置是否正确，参考安装说明->客户端\n* 存在脏数据缓存，等待5-10分钟（之前逻辑为客户端上报的时候会创建文件缓存，每五分钟删除一次，重新安装服务端后客户端文件缓存未删除，出现脏数据缓存，导致短时间内无法上报，现已将缓存写入内存中，重装服务端后重启服务端fpm和重启swoole-admin服务就能正常接收数据，无需等待）\n* 检查采样率`apm.sampling_rate`\n* 检查配置项`apm.agent_host`是否正确，为本地agent的ip，可不设置。\n\n## 3. Service应用无调用统计、链路追踪信息\n\n* 检查服务名是否存在于服务端\n* 检查代码使用是否正确，参考安装说明->上报监控数据\n* 检查客户端服务名和服务端创建是否一致\n* 同问题2\n\n## 4. 管理NodeAgent守护进程\n\n目前NodeAgent采用系统的守护进程管理，如果要管理NodeAgent的状态：\n\n* 对于采用openrc和类似sysvinit的系统（如Debian 7 \"Wheezy\", Ubuntu 14.04 \"Trusty\"（默认不安装systemd）, CentOS(RHEL) 6, Fedora 14, Gentoo（可选）, Archlinux（可选）, Alpine Linux）使用命令\n\n```bash\n\/etc\/init.d\/node-agent start\n\/etc\/init.d\/node-agent stop\n\/etc\/init.d\/node-agent restart\n```\n\n来启动\/停止\/重启NodeAgent（非root用户需要sudo）\n\n* 对于采用systemd的系统（Debian 8 \"Jessie\"及以后, Ubuntu 15.04 \"Vivid\"及以后, CentOS(RHEL) 7及以后, Fedora 15及以后, Gentoo（可选）, Archlinux（可选））使用命令\n\n```bash\nsystemctl start node-agent\nsystemctl stop node-agent\nsystemctl restart node-agent\n```\n\n来启动\/停止\/重启NodeAgent（非root用户需要sudo）\n\n## 5. 增加调试器中的相关代码后报错： Fatal error: Uncaught Exception: plz set apm.enable_memcheck=1 which in php.ini\n\n解决方法：在 `php.ini` 中添加配置： `apm.enable_memcheck=1`\n\n>[info] 从2.3.3版本以后默认关闭调试功能，需要手动进行配置。或者使用远程调试\n\n## 6. 重装服务端并清空数据库后，没有上报信息等情况\n\n从2.3.3版本开始有部分信息缓存在php内存中，服务端重装后，数据对应不上导致部分数据获取失败，所以客户端需要重启fpm进程\n\n## 7. 机器信息无上报信息\n\n1. 检查网络是否通畅\n2. 查看客户端日志 `\/opt\/swoole\/logs\/NodeAgent-sysinfoerr.log` 是否存在，存在查看内容，是否有上报失败字样\n3. 服务端地址是否正确\n\n## 8. 进程列表无信息\n\n1. 查看客户端node-agent进程是否存在\n2. 查看客户端本地是否有pid文件，路径：`\/var\/run\/swoole_tracker\/`下的cli和fpm文件夹中\n3. pid文件对应的进程是否正常\n\n## 9. 加载扩展后报错`undefined symbol: php_pdo_get_exception`\n\n扩展需要放在pdo扩展后面加载。使用`php --ini | grep \"Scan for additional .ini files in:\"`查看第三方加载目录，在此目录中创建一个`swoole_tracker`的配置\n![](images\/screenshot_1566982265088.png)\n\n## 10. 加载扩展后报错`undefined symbol: compiler_globals in Unknown`\n\n扩展支持`nts`非线程安全版本PHP，可使用命令`php -v`查看\n![](images\/screenshot_1566982251150.png)\n\n## 11. 客户端运行报错 sw_get_entrypoint()：ERROR：mkdir error, make sure that start the agent first (Premission denied).\n\n请使用 root 用户启动 Agent服务，没有启动 Agent 服务并且不是使用 root 用户启动时会报这个错误\n\n## 12. 业务开启进程数较多或动态调整进程数模式，导致客户端agent的worker进程占用cpu过高\n\n解决方法是优化业务的最低进程数；或者合理修改客户端agent的worker进程数，修改[配置文件](.\/installation\/client\/user-config.md)中的`system_worker_num`\n\n## 13. 以上的2、3、7、8问题查看后依旧无信息\n\n如果你将服务单独使用Docker（单独的NodeAgent容器）进行部署的，需要检测对应的网络连接是否通畅，即检查是否在同一网段内。\n\n可使用`telnet`等工具测试上文中的对应端口。\n\n## 14. Agent列表的某个机器为红色\n\n先查看Agent连接是否正常，如果正常请检查该机器的系统时间是否正常。\n\n## 15. 报错：PHP Startup: apm.enable and apm.enable_malloc_hook can't be turned on together, reset apm.enable=0\n\n开启了`apm.enable_malloc_hook =1`之后其他的功能均不可用，只能进行内存泄漏检测。","meta":{"mtime":"2021-01-02T10:50:19+00:00"}},"options":{"poweredBy":{"name":"顶想云","link":"https:\/\/www.topthink.com"}}}
</script>

    <script src="asset/lodash/lodash.min.js?v=4.17.21"></script>

    <script src="asset/react/react.production.min.js?v=18.2.0"></script>

    <script src="asset/react-dom/react-dom.production.min.js?v=18.2.0"></script>

    <script src="asset/reader/index.js?v=1.0.66-alpha.7+5dae540"></script>

    <script src="asset/plugins/highlight/index.js?v=1.0.4"></script>

    <script src="asset/plugins/image-zoom/index.js?v=0.0.1"></script>

    <script src="asset/plugins/theme-default/index.js?v=1.0.30"></script>

<script type="text/javascript">
    TopWrite.bootstrap();
</script>
</body>
</html>
