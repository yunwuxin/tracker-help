<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>调试器 - Untitled</title>
    
    
</head>
<body>
<div id="root"></div>
<script type="application/payload+json">
{"id":"Jrymro","sha":"164504e743217af9f2c75534a7496bb2b403bd27","summary":[{"title":"","articles":[{"title":"安装说明","ref":"installation.md","path":"installation.html","metadata":{"mtime":"2021-08-26T04:02:01+00:00"},"children":[{"title":"tracker服务端","ref":"installation\/server.md","path":"installation\/server.html","metadata":{"mtime":"2020-10-01T02:43:42+00:00"},"children":[{"title":"数据存储","ref":"installation\/server\/data-storage.md","path":"installation\/server\/data-storage.html","metadata":{"mtime":"2020-03-05T02:13:12+00:00"}},{"title":"更换数据存储配置","ref":"change-db.md","path":"change-db.html","metadata":{"mtime":"2020-09-23T06:27:02+00:00"}},{"title":"Server管理","ref":"installation\/server\/manage.md","path":"installation\/server\/manage.html","metadata":{"mtime":"2020-02-28T03:05:17+00:00"}},{"title":"数据清理","ref":"installation\/clean-log.md","path":"installation\/clean-log.html","metadata":{"mtime":"2021-08-25T06:03:28+00:00"}}]},{"title":"tracker客户端","ref":"installation\/client.md","path":"installation\/client.html","metadata":{"mtime":"2021-08-26T04:02:01+00:00"},"children":[{"title":"系统配置","ref":"installation\/client\/agent-config.md","path":"installation\/client\/agent-config.html","metadata":{"mtime":"2020-09-17T11:29:08+00:00"}},{"title":"自定义配置","ref":"installation\/client\/user-config.md","path":"installation\/client\/user-config.html","metadata":{"mtime":"2021-09-06T02:37:48+00:00"}},{"title":"链路追踪扩展","ref":"installation\/client\/trace_tlist.md","path":"installation\/client\/trace_tlist.html","metadata":{"mtime":"2021-09-06T02:37:48+00:00"}}]},{"title":"上报监控数据","ref":"installation\/reprot.md","path":"installation\/reprot.html","metadata":{"mtime":"2021-09-08T09:58:59+00:00"}}]},{"title":"名词解释","ref":"noun-interpretation.md","path":"noun-interpretation.html","metadata":{"mtime":"2019-09-27T03:11:51+00:00"}},{"title":"常见问题","ref":"qa.md","path":"qa.html","metadata":{"mtime":"2021-01-02T10:50:19+00:00"}},{"title":"首页","ref":"application-list.md","path":"application-list.html","metadata":{"mtime":"2019-10-15T03:54:15+00:00"}},{"title":"调用统计","ref":"application-monitoring.md","path":"application-monitoring.html","metadata":{"mtime":"2021-10-20T15:55:23+08:00"}},{"title":"链路追踪","ref":"application-tracking.md","path":"application-tracking.html","metadata":{"mtime":"2021-10-20T15:55:23+08:00"}},{"title":"调试器适用场景","ref":"debug-explain.md","path":"debug-explain.html","metadata":{"mtime":"2020-09-23T07:46:06+00:00"}},{"title":"调试器","ref":"debuger.md","path":"debuger.html","metadata":{"mtime":"2020-09-23T07:53:25+00:00"}},{"title":"免费内存检测工具","ref":"leak.md","path":"leak.html"},{"title":"Agent列表","ref":"agent-list.md","path":"agent-list.html"},{"title":"机器信息","ref":"sysinfo.md","path":"sysinfo.html"},{"title":"报警管理","ref":"alert.md","path":"alert.html"},{"title":"项目管理","ref":"project.md","path":"project.html"},{"title":"应用管理","ref":"module.md","path":"module.html"},{"title":"接口管理","ref":"interface.md","path":"interface.html"},{"title":"用户管理","ref":"user.md","path":"user.html","children":[{"title":"第三方登录","ref":"user\/oauth-login.md","path":"user\/oauth-login.html"}]},{"title":"对外开放API","ref":"api.md","path":"api.html"},{"title":"联系我们","ref":"contact-us.md","path":"contact-us.html"}]}],"config":{"plugins":["highlight","image-zoom"],"pluginsConfig":{"highlight":{"defaultLanguage":"markup"},"theme-default":{"show_nav":true,"logo":{"image":"https:\/\/img.kancloud.cn\/4e\/45\/4e45172f86ac746e40eb69c2827ae271_157x77.png","url":"https:\/\/business.swoole.com\/"}}},"themeConfig":{"expandLevel":1,"navs":[{"title":"Swoole Tracker 详细手册","url":"http:\/\/wiki.tracker.swoole-cloud.com"},{"title":"基础手册","url":"http:\/\/base-wiki.tracker.swoole-cloud.com"}]}},"file":{"path":"debuger.html","content":"[TOC]\n\n## 进程列表\n\n统计客户端机器`fpm`和`cli`进程内存占用和CPU占用，操作开启关闭远程调试，可批量开启全部\n![](images\/screenshot_1570757670492.png)\n\n## 远程调试\n\n对于以下四种工具，可以直接在服务端点击按钮远程开启后进行调试，无需修改代码，重启服务。开启后发生请求，日志自动上传服务端后台进行分析展示。\n\n>[danger] 对性能有所影响，开启调试完毕后请及时关闭。\n\n## 手动埋点调试\n\n>[info] **远程调试和手动埋点二选一即可，不可重复开启；**\n> 性能分析、内存泄漏、阻塞检测都比较影响性能，建议在开发\/测试环境中使用；\n> 如需在生产环境中使用，在使用后请尽快移除；\n> 注意不要同时开启多个工具，例如代码中同时 startXhprof() 和 startBlockCheck() 这样会相互影响导致结果都不准确。\n\n### 性能分析\n\n![](images\/1563769687670-cd45c986-e857-48c3-8981-d52e36c8ddc0-20190806121828093.png)\n\n在客户端需要进行性能分析的代码中进行手动埋点\n\n* 在代码开头添加\n\n```php\nstartXhprof();\n```\n\n* 在代码结束添加\n\n```php\nendXhprof();\n```\n\n实例：\n\n```php\n<?php\n\/\/ 开始\nstartXhprof();\n\nfunction a($arg){\n  echo $arg;\n}\na(123);\n\n\/\/ 结束\nendXhprof();\n```\n\n#### 分层分析表\n\n![](images\/1563769717158-2c26497f-690c-42f6-bf5c-276ce0a46c89-20190806121826867.png)\n\n#### 调用图\n\n客户端会自动上报生成的日志信息，在后台就可以看到所生成的性能瓶颈图\n\n![](images\/1561520792301-305d099c-0962-424f-a74d-51fdbba98d8c-20190806121828415.png)\n\n图中会指出：函数；`Inc`函数运行时间，包括子函数；`Excl`函数运行时间，不包括子函数；`total calls`总调用次数；\n\n#### 火焰图\n\n![](images\/1557024696925-c035e2c1-0e6f-41b5-8ad4-17123f79d2ae-20190806121825748.png)\n\n增加了查看火焰图的功能，火焰图是性能分析的利器，并可以与用户互动。\n\n* 鼠标悬浮\n\n火焰的每一层都会标注函数名，鼠标悬浮时会显示完整的函数名、抽样抽中的次数、占据总抽样次数的百分比。\n\n下面是一个例子：\n\n![](images\/1557024824683-c4d0ef1e-5080-414e-b6f9-ea7c13cdf1d2-20190806121825489.png)\n\n* 点击放大\n\n在某一层点击，火焰图会水平放大，该层会占据所有宽度，显示详细信息。\n\n![](images\/1557024958398-fb7e35d0-2b30-4fdb-b651-ddb1c491de38-20190806121825635.png)\n\n左上角会同时显示\"Reset Zoom\"，点击该链接，图片就会恢复原样。\n\n* 搜索\n\n按下 `Ctrl + F`  或者点击图中右上角的 `Search` 会显示一个搜索框，用户可以输入关键词或正则表达式，所有符合条件的函数名会高亮显示。\n\n![](images\/1557025097796-3a61c97c-672b-439c-b040-e85ab6a1ad09-20190806121825906.png)\n\n![](images\/1557025109639-8675437b-ed3e-4aae-b110-d9e77a3a9398-20190806121827236.png)\n\n### 内存泄漏\n\n>[danger]  ⚠️此功能仅支持 PHP71+ 版本，即PHP71、PHP72、PHP73，在`Swoole Tracker 3.0+`版本推荐使用[此工具](leak.md)检测泄漏\n\n在客户端需要进行内存泄漏检测的代码中进行手动埋点\n\n* 在代码开头添加\n\n```php\nstartMemleakCheck();\n```\n\n* 在代码结束添加\n\n```php\nendMemleakCheck();\n```\n\n实例：\n\n```php\n<?php\n\/\/ 开始\nstartMemleakCheck();\n\n$redis;\nfunction a(){\n    global $redis;\n    $redis  = new \\redis();\n    $result = $redis->connect('127.0.0.1', 6379);\n    $redis->set(\"dasda\",123123);\n    var_dump($redis->get(\"dasda\"));\n}\na();\n\n\/\/ 结束\nendMemleakCheck();\n```\n\n会说明存在内存泄漏到文件行数，对应到键名，此处可能需要进行修改或者进行 `unset`\n\n![](images\/1556519123913-31195e18-a36d-4d1b-8718-988d0c7be2e8-20190806121826148.png)\n\n### 阻塞检测\n\n>[warning] ⚠️该检测不追踪fork的子进程。\n\n在客户端需要进行阻塞检测的代码中进行手动埋点\n\n![](images\/1558499079749-a015e40a-ffe7-42a2-b248-4ec87e63e04a-20190806121827839.png)\n\n>[info] 反应堆解释：\n> 如果使用swoole会产生较多的的epoll_wait、epoll_wait_old、epoll_pwait，等待事件发生。可选择检测时列表是否将此类信息过滤不进行展示。\n\n* 在代码开头添加\n\n```php\nstartBlockCheck();\n```\n\n* 在代码结束添加\n\n```php\nendBlockCheck();\n```\n\n默认检测阻塞10ms的数据，大于这个值的系统调用就认为是阻塞的，如果要修改请编辑文件 `\/opt\/swoole\/config\/config_common.conf`\n\n```json\n{\"protocol\":\"TCP\",\"block_time_out\":\"10\"}\n```\n\n修改 `block_time_out` 的值，修改后需要重启NodeAgent\n\n### 查看调用栈\n\n方便定位 PHP 卡死问题，包括但不限于`死循环`、`sesstion_start函数导致卡死`、`flock函数导致卡死`、`TCP超时时间为-1`、`swoole协程的lock`等\n![](images\/screenshot_1570758476153.png)\n\n增加了调用栈的页面，**开启并且发生请求后**就会上报\n![](images\/screenshot_1571643145286.png)","meta":{"mtime":"2020-09-23T07:53:25+00:00"}},"options":{"poweredBy":{"name":"顶想云","link":"https:\/\/www.topthink.com"}}}
</script>

    <script src="asset/lodash/lodash.min.js?v=4.17.21"></script>

    <script src="asset/react/react.production.min.js?v=18.2.0"></script>

    <script src="asset/react-dom/react-dom.production.min.js?v=18.2.0"></script>

    <script src="asset/reader/index.js?v=1.0.66-alpha.7+5dae540"></script>

    <script src="asset/plugins/highlight/index.js?v=1.0.4"></script>

    <script src="asset/plugins/image-zoom/index.js?v=0.0.1"></script>

    <script src="asset/plugins/theme-default/index.js?v=1.0.30"></script>

<script type="text/javascript">
    TopWrite.bootstrap();
</script>
</body>
</html>
